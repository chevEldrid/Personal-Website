<!Doctype HTML>
  <head>
    <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.css">
      <!--  -->
      <title>Momir Basic</title>
      <style type="text/css">
        /*Universal Properties*/
        body {
          background-color: black;
          color: white;
        }
        
        .modal {
          color: black;
        }

        #Card-image {
            height: 70%;
            width: 70%;
            margin: 0 0 0 0;
        }

        @media only screen and (min-width: 600px) {
          #Card-image {
            height: 50%;    
            width: 50%;
            margin: 0 0 0 0;
          }
        }
        
      </style>
  </head>
  <body onload="loadDoc()">
    <main role="main" class="container">
      <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
          <div class="text-center">
            <img class="img-fluid mx-auto d-block" id="Card-image" />
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
          <div id="Button-row" class="text-center mobile-view">
            <button type="button" class="btn btn-light" onclick="dropCount()">-</button>
            <button id="CCount" cmccount="0" type="button" class="btn btn-light" onclick="generate()">x = 0</button>
            <button type="button" class="btn btn-light" onclick="addCount()">+</button>
            <button type="button" class="btn btn-light" data-toggle="modal" data-target="#exampleModal">
              Settings
            </button>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
          <div class="text-center mobile-view mobile-counter">
            <h1 id="Chaos-roll"></h1>
          </div>
        </div>
      </div>
      
      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Momir Settings</h5>
              <button type="button" class="close" data-dismiss="modal" onclick="clearList()" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                <form action="">
                    <input type="radio" name="format" value="standard"> Standard<br>
                    <input type="radio" name="format" value="modern"> Modern<br>
                    <input type="radio" name="format" value="legacy" checked> Legacy<br>
                    <input type="radio" name="format" value="vintage"> Vintage<br>
                </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="changeFormat()">Save changes</button>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" ></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script>
      //global variables
      //current image-id
      var curImageID = "Card-image";
      //current format
      var legalFormat = "legacy";
        //remind us what we're playing...
        function loadDoc() {
            var xhttp = new XMLHttpRequest();
            var requestString = "https://api.scryfall.com/cards/search?q=t%3Avanguard+name%3Amomir";
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var response = JSON.parse(this.responseText);
                    var card = response.data[0];
                    updateImageField(card.image_uris.normal);
                }
            };
        xhttp.open("GET", requestString, true);
        xhttp.send();
        }


      //changes selected format for cardpool    
      function changeFormat() {
          var tempFormat = document.querySelector('input[name = "format"]:checked').value;
          legalFormat = tempFormat;
      }
      //starting specific coding for momir basic
      function generate() {
          var genButton = document.getElementById("CCount");
          var x = parseInt(genButton.getAttribute('cmccount'));
          //alert(x);
          generateCard(x);
      }
      //increase CCount cmcCount by one
      function addCount() {
          var genButton = document.getElementById("CCount");
          var newX = parseInt(genButton.getAttribute('cmccount'))+1;
          if (newX > 16)
            newX = 16;
          genButton.setAttribute('cmccount', newX);
          genButton.innerText = "x = "+newX;
      }

      //increase CCount cmcCount by one
      function dropCount() {
          var genButton = document.getElementById("CCount");
          var newX = parseInt(genButton.getAttribute('cmccount'))-1;
          if(newX < 0)
              newX = 0;
          genButton.setAttribute('cmccount', newX);
          genButton.innerText = "x = "+newX;
      }

      //given a value x: returns a random creature with x cmc
      function generateCard(x) {
        var xhttp = new XMLHttpRequest();
        var requestString = "https://api.scryfall.com/cards/random?q=t%3Acreature+f%3A" + legalFormat +"+cmc%3D" + x;
        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            var response = JSON.parse(this.responseText);
            var card = response;
            updateImageField(card.image_uris.normal);
          }
          else if (this.status == 404) {
              alert("No Creature exists at this cmc...");
          }
        };
        xhttp.open("GET", requestString, true);
        xhttp.send();
      }

      //updates necessary fields of image with new ID
      //sets src to first img in list
      function updateImageField(imageSrc) {
        var image = document.getElementById(curImageID);
        image.src = imageSrc;
      };
    </script>
  </body>
  </html>
